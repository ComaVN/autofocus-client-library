#!/usr/bin/env python2.7
from autofocus import AFSample, AFClientError, AutoFocusAPI

query = """
{
    "operator":"all",
    "children":[
        {
            "operator":"any",
            "children":[
                {
                    "operator":"all",
                    "children":[
                        {
                            "field":"sample.tasks.http",
                            "operator":"contains",
                            "value":"/2c.php?os="
                        },
                        {
                            "field":"sample.tasks.http",
                            "operator":"contains",
                            "value":"&other=sms"
                        }
                    ]
                },
                {
                    "field":"sample.tasks.apk_embeded_url",
                    "operator":"contains",
                    "value":"http://112.126.69.51/2c.php"
                }
            ]
        },
        {
            "field": "sample.malware",
            "operator": "is",
            "value": "0"
        }
    ]
}
"""

samples = []
print "sha256,md5,filetype,size"
try:
    for sample in AFSample.search(query):
        samples.append(sample)
        print ",".join((sample.sha256,sample.md5, sample.file_type, str(sample.size)))
except AFClientError as e:
    print e

print "%d samples" % (len(samples),)
